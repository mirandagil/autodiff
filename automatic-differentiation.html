<!DOCTYPE html>
<HTML lang = "en">
<HEAD>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Automatic Differentiation</title>
  

  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
      TeX: { equationNumbers: { autoNumber: "AMS" } }
    });
  </script>

  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>

  
<style>
pre.hljl {
    border: 1px solid #ccc;
    margin: 5px;
    padding: 5px;
    overflow-x: auto;
    color: rgb(68,68,68); background-color: rgb(251,251,251); }
pre.hljl > span.hljl-t { }
pre.hljl > span.hljl-w { }
pre.hljl > span.hljl-e { }
pre.hljl > span.hljl-eB { }
pre.hljl > span.hljl-o { }
pre.hljl > span.hljl-k { color: rgb(148,91,176); font-weight: bold; }
pre.hljl > span.hljl-kc { color: rgb(59,151,46); font-style: italic; }
pre.hljl > span.hljl-kd { color: rgb(214,102,97); font-style: italic; }
pre.hljl > span.hljl-kn { color: rgb(148,91,176); font-weight: bold; }
pre.hljl > span.hljl-kp { color: rgb(148,91,176); font-weight: bold; }
pre.hljl > span.hljl-kr { color: rgb(148,91,176); font-weight: bold; }
pre.hljl > span.hljl-kt { color: rgb(148,91,176); font-weight: bold; }
pre.hljl > span.hljl-n { }
pre.hljl > span.hljl-na { }
pre.hljl > span.hljl-nb { }
pre.hljl > span.hljl-nbp { }
pre.hljl > span.hljl-nc { }
pre.hljl > span.hljl-ncB { }
pre.hljl > span.hljl-nd { color: rgb(214,102,97); }
pre.hljl > span.hljl-ne { }
pre.hljl > span.hljl-neB { }
pre.hljl > span.hljl-nf { color: rgb(66,102,213); }
pre.hljl > span.hljl-nfm { color: rgb(66,102,213); }
pre.hljl > span.hljl-np { }
pre.hljl > span.hljl-nl { }
pre.hljl > span.hljl-nn { }
pre.hljl > span.hljl-no { }
pre.hljl > span.hljl-nt { }
pre.hljl > span.hljl-nv { }
pre.hljl > span.hljl-nvc { }
pre.hljl > span.hljl-nvg { }
pre.hljl > span.hljl-nvi { }
pre.hljl > span.hljl-nvm { }
pre.hljl > span.hljl-l { }
pre.hljl > span.hljl-ld { color: rgb(148,91,176); font-style: italic; }
pre.hljl > span.hljl-s { color: rgb(201,61,57); }
pre.hljl > span.hljl-sa { color: rgb(201,61,57); }
pre.hljl > span.hljl-sb { color: rgb(201,61,57); }
pre.hljl > span.hljl-sc { color: rgb(201,61,57); }
pre.hljl > span.hljl-sd { color: rgb(201,61,57); }
pre.hljl > span.hljl-sdB { color: rgb(201,61,57); }
pre.hljl > span.hljl-sdC { color: rgb(201,61,57); }
pre.hljl > span.hljl-se { color: rgb(59,151,46); }
pre.hljl > span.hljl-sh { color: rgb(201,61,57); }
pre.hljl > span.hljl-si { }
pre.hljl > span.hljl-so { color: rgb(201,61,57); }
pre.hljl > span.hljl-sr { color: rgb(201,61,57); }
pre.hljl > span.hljl-ss { color: rgb(201,61,57); }
pre.hljl > span.hljl-ssB { color: rgb(201,61,57); }
pre.hljl > span.hljl-nB { color: rgb(59,151,46); }
pre.hljl > span.hljl-nbB { color: rgb(59,151,46); }
pre.hljl > span.hljl-nfB { color: rgb(59,151,46); }
pre.hljl > span.hljl-nh { color: rgb(59,151,46); }
pre.hljl > span.hljl-ni { color: rgb(59,151,46); }
pre.hljl > span.hljl-nil { color: rgb(59,151,46); }
pre.hljl > span.hljl-noB { color: rgb(59,151,46); }
pre.hljl > span.hljl-oB { color: rgb(102,102,102); font-weight: bold; }
pre.hljl > span.hljl-ow { color: rgb(102,102,102); font-weight: bold; }
pre.hljl > span.hljl-p { }
pre.hljl > span.hljl-c { color: rgb(153,153,119); font-style: italic; }
pre.hljl > span.hljl-ch { color: rgb(153,153,119); font-style: italic; }
pre.hljl > span.hljl-cm { color: rgb(153,153,119); font-style: italic; }
pre.hljl > span.hljl-cp { color: rgb(153,153,119); font-style: italic; }
pre.hljl > span.hljl-cpB { color: rgb(153,153,119); font-style: italic; }
pre.hljl > span.hljl-cs { color: rgb(153,153,119); font-style: italic; }
pre.hljl > span.hljl-csB { color: rgb(153,153,119); font-style: italic; }
pre.hljl > span.hljl-g { }
pre.hljl > span.hljl-gd { }
pre.hljl > span.hljl-ge { }
pre.hljl > span.hljl-geB { }
pre.hljl > span.hljl-gh { }
pre.hljl > span.hljl-gi { }
pre.hljl > span.hljl-go { }
pre.hljl > span.hljl-gp { }
pre.hljl > span.hljl-gs { }
pre.hljl > span.hljl-gsB { }
pre.hljl > span.hljl-gt { }
</style>



  <style type="text/css">
  @font-face {
  font-style: normal;
  font-weight: 300;
}
@font-face {
  font-style: normal;
  font-weight: 400;
}
@font-face {
  font-style: normal;
  font-weight: 600;
}
html {
  font-family: sans-serif; /* 1 */
  -ms-text-size-adjust: 100%; /* 2 */
  -webkit-text-size-adjust: 100%; /* 2 */
}
body {
  margin: 0;
}
article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
menu,
nav,
section,
summary {
  display: block;
}
audio,
canvas,
progress,
video {
  display: inline-block; /* 1 */
  vertical-align: baseline; /* 2 */
}
audio:not([controls]) {
  display: none;
  height: 0;
}
[hidden],
template {
  display: none;
}
a:active,
a:hover {
  outline: 0;
}
abbr[title] {
  border-bottom: 1px dotted;
}
b,
strong {
  font-weight: bold;
}
dfn {
  font-style: italic;
}
h1 {
  font-size: 2em;
  margin: 0.67em 0;
}
mark {
  background: #ff0;
  color: #000;
}
small {
  font-size: 80%;
}
sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
sup {
  top: -0.5em;
}
sub {
  bottom: -0.25em;
}
img {
  border: 0;
}
svg:not(:root) {
  overflow: hidden;
}
figure {
  margin: 1em 40px;
}
hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}
pre {
  overflow: auto;
}
code,
kbd,
pre,
samp {
  font-family: monospace, monospace;
  font-size: 1em;
}
button,
input,
optgroup,
select,
textarea {
  color: inherit; /* 1 */
  font: inherit; /* 2 */
  margin: 0; /* 3 */
}
button {
  overflow: visible;
}
button,
select {
  text-transform: none;
}
button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
  -webkit-appearance: button; /* 2 */
  cursor: pointer; /* 3 */
}
button[disabled],
html input[disabled] {
  cursor: default;
}
button::-moz-focus-inner,
input::-moz-focus-inner {
  border: 0;
  padding: 0;
}
input {
  line-height: normal;
}
input[type="checkbox"],
input[type="radio"] {
  box-sizing: border-box; /* 1 */
  padding: 0; /* 2 */
}
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
  height: auto;
}
input[type="search"] {
  -webkit-appearance: textfield; /* 1 */
  -moz-box-sizing: content-box;
  -webkit-box-sizing: content-box; /* 2 */
  box-sizing: content-box;
}
input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
  -webkit-appearance: none;
}
fieldset {
  border: 1px solid #c0c0c0;
  margin: 0 2px;
  padding: 0.35em 0.625em 0.75em;
}
legend {
  border: 0; /* 1 */
  padding: 0; /* 2 */
}
textarea {
  overflow: auto;
}
optgroup {
  font-weight: bold;
}
table {
  font-family: monospace, monospace;
  font-size : 0.8em;
  border-collapse: collapse;
  border-spacing: 0;
}
td,
th {
  padding: 0;
}
thead th {
    border-bottom: 1px solid black;
    background-color: white;
}
tr:nth-child(odd){
  background-color: rgb(248,248,248);
}


/*
* Skeleton V2.0.4
* Copyright 2014, Dave Gamache
* www.getskeleton.com
* Free to use under the MIT license.
* http://www.opensource.org/licenses/mit-license.php
* 12/29/2014
*/
.container {
  position: relative;
  width: 100%;
  max-width: 960px;
  margin: 0 auto;
  padding: 0 20px;
  box-sizing: border-box; }
.column,
.columns {
  width: 100%;
  float: left;
  box-sizing: border-box; }
@media (min-width: 400px) {
  .container {
    width: 85%;
    padding: 0; }
}
@media (min-width: 550px) {
  .container {
    width: 80%; }
  .column,
  .columns {
    margin-left: 4%; }
  .column:first-child,
  .columns:first-child {
    margin-left: 0; }

  .one.column,
  .one.columns                    { width: 4.66666666667%; }
  .two.columns                    { width: 13.3333333333%; }
  .three.columns                  { width: 22%;            }
  .four.columns                   { width: 30.6666666667%; }
  .five.columns                   { width: 39.3333333333%; }
  .six.columns                    { width: 48%;            }
  .seven.columns                  { width: 56.6666666667%; }
  .eight.columns                  { width: 65.3333333333%; }
  .nine.columns                   { width: 74.0%;          }
  .ten.columns                    { width: 82.6666666667%; }
  .eleven.columns                 { width: 91.3333333333%; }
  .twelve.columns                 { width: 100%; margin-left: 0; }

  .one-third.column               { width: 30.6666666667%; }
  .two-thirds.column              { width: 65.3333333333%; }

  .one-half.column                { width: 48%; }

  /* Offsets */
  .offset-by-one.column,
  .offset-by-one.columns          { margin-left: 8.66666666667%; }
  .offset-by-two.column,
  .offset-by-two.columns          { margin-left: 17.3333333333%; }
  .offset-by-three.column,
  .offset-by-three.columns        { margin-left: 26%;            }
  .offset-by-four.column,
  .offset-by-four.columns         { margin-left: 34.6666666667%; }
  .offset-by-five.column,
  .offset-by-five.columns         { margin-left: 43.3333333333%; }
  .offset-by-six.column,
  .offset-by-six.columns          { margin-left: 52%;            }
  .offset-by-seven.column,
  .offset-by-seven.columns        { margin-left: 60.6666666667%; }
  .offset-by-eight.column,
  .offset-by-eight.columns        { margin-left: 69.3333333333%; }
  .offset-by-nine.column,
  .offset-by-nine.columns         { margin-left: 78.0%;          }
  .offset-by-ten.column,
  .offset-by-ten.columns          { margin-left: 86.6666666667%; }
  .offset-by-eleven.column,
  .offset-by-eleven.columns       { margin-left: 95.3333333333%; }

  .offset-by-one-third.column,
  .offset-by-one-third.columns    { margin-left: 34.6666666667%; }
  .offset-by-two-thirds.column,
  .offset-by-two-thirds.columns   { margin-left: 69.3333333333%; }

  .offset-by-one-half.column,
  .offset-by-one-half.columns     { margin-left: 52%; }

}
html {
  font-size: 62.5%; }
body {
  font-size: 1.5em; /* currently ems cause chrome bug misinterpreting rems on body element */
  line-height: 1.6;
  font-weight: 400;
  font-family: "Raleway", "HelveticaNeue", "Helvetica Neue", Helvetica, Arial, sans-serif;
  color: #222; }
h1, h2, h3, h4, h5, h6 {
  margin-top: 0;
  margin-bottom: 2rem;
  font-weight: 300; }
h1 { font-size: 3.6rem; line-height: 1.2;  letter-spacing: -.1rem;}
h2 { font-size: 3.4rem; line-height: 1.25; letter-spacing: -.1rem; }
h3 { font-size: 3.2rem; line-height: 1.3;  letter-spacing: -.1rem; }
h4 { font-size: 2.8rem; line-height: 1.35; letter-spacing: -.08rem; }
h5 { font-size: 2.4rem; line-height: 1.5;  letter-spacing: -.05rem; }
h6 { font-size: 1.5rem; line-height: 1.6;  letter-spacing: 0; }

p {
  margin-top: 0; }
a {
  color: #1EAEDB; }
a:hover {
  color: #0FA0CE; }
.button,
button,
input[type="submit"],
input[type="reset"],
input[type="button"] {
  display: inline-block;
  height: 38px;
  padding: 0 30px;
  color: #555;
  text-align: center;
  font-size: 11px;
  font-weight: 600;
  line-height: 38px;
  letter-spacing: .1rem;
  text-transform: uppercase;
  text-decoration: none;
  white-space: nowrap;
  background-color: transparent;
  border-radius: 4px;
  border: 1px solid #bbb;
  cursor: pointer;
  box-sizing: border-box; }
.button:hover,
button:hover,
input[type="submit"]:hover,
input[type="reset"]:hover,
input[type="button"]:hover,
.button:focus,
button:focus,
input[type="submit"]:focus,
input[type="reset"]:focus,
input[type="button"]:focus {
  color: #333;
  border-color: #888;
  outline: 0; }
.button.button-primary,
button.button-primary,
input[type="submit"].button-primary,
input[type="reset"].button-primary,
input[type="button"].button-primary {
  color: #FFF;
  background-color: #33C3F0;
  border-color: #33C3F0; }
.button.button-primary:hover,
button.button-primary:hover,
input[type="submit"].button-primary:hover,
input[type="reset"].button-primary:hover,
input[type="button"].button-primary:hover,
.button.button-primary:focus,
button.button-primary:focus,
input[type="submit"].button-primary:focus,
input[type="reset"].button-primary:focus,
input[type="button"].button-primary:focus {
  color: #FFF;
  background-color: #1EAEDB;
  border-color: #1EAEDB; }
input[type="email"],
input[type="number"],
input[type="search"],
input[type="text"],
input[type="tel"],
input[type="url"],
input[type="password"],
textarea,
select {
  height: 38px;
  padding: 6px 10px; /* The 6px vertically centers text on FF, ignored by Webkit */
  background-color: #fff;
  border: 1px solid #D1D1D1;
  border-radius: 4px;
  box-shadow: none;
  box-sizing: border-box; }
/* Removes awkward default styles on some inputs for iOS */
input[type="email"],
input[type="number"],
input[type="search"],
input[type="text"],
input[type="tel"],
input[type="url"],
input[type="password"],
textarea {
  -webkit-appearance: none;
     -moz-appearance: none;
          appearance: none; }
textarea {
  min-height: 65px;
  padding-top: 6px;
  padding-bottom: 6px; }
input[type="email"]:focus,
input[type="number"]:focus,
input[type="search"]:focus,
input[type="text"]:focus,
input[type="tel"]:focus,
input[type="url"]:focus,
input[type="password"]:focus,
textarea:focus,
select:focus {
  border: 1px solid #33C3F0;
  outline: 0; }
label,
legend {
  display: block;
  margin-bottom: .5rem;
  font-weight: 600; }
fieldset {
  padding: 0;
  border-width: 0; }
input[type="checkbox"],
input[type="radio"] {
  display: inline; }
label > .label-body {
  display: inline-block;
  margin-left: .5rem;
  font-weight: normal; }
ul {
  list-style: circle; }
ol {
  list-style: decimal; }
ul ul,
ul ol,
ol ol,
ol ul {
  margin: 1.5rem 0 1.5rem 3rem;
  font-size: 90%; }
li > p {margin : 0;}
th,
td {
  padding: 12px 15px;
  text-align: left;
  border-bottom: 1px solid #E1E1E1; }
th:first-child,
td:first-child {
  padding-left: 0; }
th:last-child,
td:last-child {
  padding-right: 0; }
button,
.button {
  margin-bottom: 1rem; }
input,
textarea,
select,
fieldset {
  margin-bottom: 1.5rem; }
pre,
blockquote,
dl,
figure,
table,
p,
ul,
ol,
form {
  margin-bottom: 1.0rem; }
.u-full-width {
  width: 100%;
  box-sizing: border-box; }
.u-max-full-width {
  max-width: 100%;
  box-sizing: border-box; }
.u-pull-right {
  float: right; }
.u-pull-left {
  float: left; }
hr {
  margin-top: 3rem;
  margin-bottom: 3.5rem;
  border-width: 0;
  border-top: 1px solid #E1E1E1; }
.container:after,
.row:after,
.u-cf {
  content: "";
  display: table;
  clear: both; }

pre {
  display: block;
  padding: 9.5px;
  margin: 0 0 10px;
  font-size: 13px;
  line-height: 1.42857143;
  word-break: break-all;
  word-wrap: break-word;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre.hljl {
  margin: 0 0 10px;
  display: block;
  background: #f5f5f5;
  border-radius: 4px;
  padding : 5px;
}

pre.output {
  background: #ffffff;
}

pre.code {
  background: #ffffff;
}

pre.julia-error {
  color : red
}

code,
kbd,
pre,
samp {
  font-family: Menlo, Monaco, Consolas, "Courier New", monospace;
  font-size: 0.9em;
}


@media (min-width: 400px) {}
@media (min-width: 550px) {}
@media (min-width: 750px) {}
@media (min-width: 1000px) {}
@media (min-width: 1200px) {}

h1.title {margin-top : 20px}
img {max-width : 100%}
div.title {text-align: center;}

  </style>
</HEAD>

<BODY>
  <div class ="container">
    <div class = "row">
      <div class = "col-md-12 twelve columns">
        <div class="title">
          <h1 class="title">Automatic Differentiation</h1>
          <h5>Gil Miranda</h5>
          <h5>29 de Janeiro de 2021</h5>
        </div>

        <h2>Números Duais &#40;Dual Numbers&#41;</h2>
<p>Introduzido em <code>1873</code> por <code>William Clifford</code>, os números duais são números da forma</p>
<p class="math">\[
a + b\epsilon
\]</p>
<p>Onde <span class="math">$\epsilon^2 = 0$</span>, a adição de dois números duais é definida da forma usual, componente a componente, enquanto a multiplicação é definida por</p>
<p class="math">\[
(a+b\epsilon)(c+d\epsilon) = (a+c)\left((ad + bc)\epsilon\right)
\]</p>
<p>Podemos representar um número dual <span class="math">$z = a + b\epsilon$</span> atráves de um par ordenado <span class="math">$(a,b)$</span></p>
<h4>Números Duais e a série de Taylor</h4>
<p>O que acontece se fizermos a expansão em série de Taylor de uma função avaliada em um número dual? Assumindo que <span class="math">$f(x)$</span> tenha expansão em série de Taylor, tomando um número dual <span class="math">$z = a + \epsilon$</span></p>
<p class="math">\[
\begin{align*}
f(a + \epsilon) &= f(a) + f'(a)\epsilon + \frac{f''(a)}{2!}\epsilon^2 + \sum_{k=3}^\infty \frac{f^{(k)}(a)}{k!}\epsilon^2 \epsilon^{(k-2)}\\
&=  f(a) + f'(a)\epsilon + 0\\
&=  f(a) + f'(a)\epsilon
\end{align*}
\]</p>
<p>Então o par ordenado do número dual para <span class="math">$f(z) = (a, f'(a))$</span>, com isso nós temos uma maneira de encontrar o valor númerico EXATO da derivada de uma função <span class="math">$f$</span> no ponto <span class="math">$a$</span> enquanto calculamos a própria função no ponto&#33;&#33;</p>
<h4>Números Duais e Julia, uma implementação rápida</h4>
<p>Vamos criar uma nova estrutura de dados para comportar os números <code>Duais</code></p>


<pre class='hljl'>
<span class='hljl-k'>struct</span><span class='hljl-t'> </span><span class='hljl-n'>D</span><span class='hljl-t'> </span><span class='hljl-oB'>&lt;:</span><span class='hljl-t'> </span><span class='hljl-n'>Number</span><span class='hljl-t'>
    </span><span class='hljl-n'>v</span><span class='hljl-oB'>::</span><span class='hljl-n'>Float64</span><span class='hljl-t'>
    </span><span class='hljl-n'>ϵ</span><span class='hljl-oB'>::</span><span class='hljl-n'>Float64</span><span class='hljl-t'>
</span><span class='hljl-k'>end</span>
</pre>



<p>Um número dual será formado então por duas partes, uma real que acessaremos com <code>v</code> de valor, e uma dual que acessaremos  com <code>ϵ</code>. Podemos criar um número dual com o comando</p>


<pre class='hljl'>
<span class='hljl-n'>x</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-nfB'>3.</span><span class='hljl-p'>,</span><span class='hljl-nfB'>1.</span><span class='hljl-p'>)</span>
</pre>


<pre class="output">
Main.##WeaveSandBox#312.D&#40;3.0, 1.0&#41;
</pre>


<p>Ainda não sabemos operar com os números duais, precisamos criar regras para isso</p>


<pre class='hljl'>
<span class='hljl-k'>import</span><span class='hljl-t'> </span><span class='hljl-n'>Base</span><span class='hljl-oB'>:</span><span class='hljl-t'> </span><span class='hljl-oB'>+</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-oB'>/</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-oB'>-</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-oB'>*</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>cos</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>sin</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>log</span><span class='hljl-p'>,</span><span class='hljl-t'>  </span><span class='hljl-n'>convert</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>promote_rule</span><span class='hljl-t'>

</span><span class='hljl-oB'>+</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-oB'>::</span><span class='hljl-n'>D</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>y</span><span class='hljl-oB'>::</span><span class='hljl-n'>D</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-oB'>.</span><span class='hljl-n'>v</span><span class='hljl-t'> </span><span class='hljl-oB'>.+</span><span class='hljl-t'> </span><span class='hljl-n'>y</span><span class='hljl-oB'>.</span><span class='hljl-n'>v</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>x</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-t'> </span><span class='hljl-oB'>.+</span><span class='hljl-t'> </span><span class='hljl-n'>y</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-oB'>-</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-oB'>::</span><span class='hljl-n'>D</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>y</span><span class='hljl-oB'>::</span><span class='hljl-n'>D</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-oB'>.</span><span class='hljl-n'>v</span><span class='hljl-t'> </span><span class='hljl-oB'>.-</span><span class='hljl-t'> </span><span class='hljl-n'>y</span><span class='hljl-oB'>.</span><span class='hljl-n'>v</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>x</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-t'> </span><span class='hljl-oB'>.-</span><span class='hljl-t'> </span><span class='hljl-n'>y</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-oB'>/</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-oB'>::</span><span class='hljl-n'>D</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>y</span><span class='hljl-oB'>::</span><span class='hljl-n'>D</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-oB'>.</span><span class='hljl-n'>v</span><span class='hljl-oB'>/</span><span class='hljl-n'>y</span><span class='hljl-oB'>.</span><span class='hljl-n'>v</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-p'>(</span><span class='hljl-n'>y</span><span class='hljl-oB'>.</span><span class='hljl-n'>v</span><span class='hljl-oB'>*</span><span class='hljl-n'>x</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-t'> </span><span class='hljl-oB'>-</span><span class='hljl-t'> </span><span class='hljl-n'>x</span><span class='hljl-oB'>.</span><span class='hljl-n'>v</span><span class='hljl-oB'>*</span><span class='hljl-n'>y</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-p'>)</span><span class='hljl-oB'>/</span><span class='hljl-n'>y</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-oB'>^</span><span class='hljl-ni'>2</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-oB'>*</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-oB'>::</span><span class='hljl-n'>D</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>y</span><span class='hljl-oB'>::</span><span class='hljl-n'>D</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-oB'>.</span><span class='hljl-n'>v</span><span class='hljl-oB'>*</span><span class='hljl-n'>y</span><span class='hljl-oB'>.</span><span class='hljl-n'>v</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>x</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-oB'>*</span><span class='hljl-n'>y</span><span class='hljl-oB'>.</span><span class='hljl-n'>v</span><span class='hljl-t'> </span><span class='hljl-oB'>+</span><span class='hljl-t'> </span><span class='hljl-n'>x</span><span class='hljl-oB'>.</span><span class='hljl-n'>v</span><span class='hljl-oB'>*</span><span class='hljl-n'>y</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nf'>cos</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-oB'>::</span><span class='hljl-n'>D</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-nf'>cos</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-oB'>.</span><span class='hljl-n'>v</span><span class='hljl-p'>),</span><span class='hljl-t'> </span><span class='hljl-oB'>-</span><span class='hljl-nf'>sin</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-oB'>.</span><span class='hljl-n'>v</span><span class='hljl-p'>)</span><span class='hljl-oB'>*</span><span class='hljl-n'>x</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nf'>sin</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-oB'>::</span><span class='hljl-n'>D</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-nf'>sin</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-oB'>.</span><span class='hljl-n'>v</span><span class='hljl-p'>),</span><span class='hljl-t'> </span><span class='hljl-nf'>cos</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-oB'>.</span><span class='hljl-n'>v</span><span class='hljl-p'>)</span><span class='hljl-oB'>*</span><span class='hljl-n'>x</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nf'>log</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-oB'>::</span><span class='hljl-n'>D</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-nf'>log</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-oB'>.</span><span class='hljl-n'>v</span><span class='hljl-p'>),</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-oB'>/</span><span class='hljl-n'>x</span><span class='hljl-oB'>.</span><span class='hljl-n'>v</span><span class='hljl-t'> </span><span class='hljl-oB'>*</span><span class='hljl-t'> </span><span class='hljl-n'>x</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-p'>)</span><span class='hljl-t'>

</span><span class='hljl-nf'>convert</span><span class='hljl-p'>(</span><span class='hljl-oB'>::</span><span class='hljl-nf'>Type</span><span class='hljl-p'>{</span><span class='hljl-n'>D</span><span class='hljl-p'>},</span><span class='hljl-t'> </span><span class='hljl-n'>x</span><span class='hljl-oB'>::</span><span class='hljl-n'>Real</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-p'>,</span><span class='hljl-nf'>zero</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-p'>))</span><span class='hljl-t'>
</span><span class='hljl-nf'>promote_rule</span><span class='hljl-p'>(</span><span class='hljl-oB'>::</span><span class='hljl-nf'>Type</span><span class='hljl-p'>{</span><span class='hljl-n'>D</span><span class='hljl-p'>},</span><span class='hljl-t'> </span><span class='hljl-oB'>::</span><span class='hljl-nf'>Type</span><span class='hljl-p'>{</span><span class='hljl-oB'>&lt;:</span><span class='hljl-n'>Number</span><span class='hljl-p'>})</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>D</span><span class='hljl-t'>
</span><span class='hljl-n'>Base</span><span class='hljl-oB'>.</span><span class='hljl-nf'>show</span><span class='hljl-p'>(</span><span class='hljl-n'>io</span><span class='hljl-oB'>::</span><span class='hljl-n'>IO</span><span class='hljl-p'>,</span><span class='hljl-n'>x</span><span class='hljl-oB'>::</span><span class='hljl-n'>D</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>print</span><span class='hljl-p'>(</span><span class='hljl-n'>io</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>x</span><span class='hljl-oB'>.</span><span class='hljl-n'>v</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot; + &quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>x</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;ϵ&quot;</span><span class='hljl-p'>)</span>
</pre>



<p>Agora sabemos usar todas essas funções com números duais, a última linha é para que possamos printar de maneira mais legível, desta forma agora o print de um número dual fica:</p>


<pre class='hljl'>
<span class='hljl-nf'>print</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-p'>)</span>
</pre>


<pre class="output">
3.0 &#43; 1.0ϵ
</pre>


<p>Agora para saber o valor da derivada de <span class="math">$x^3$</span> no ponto <span class="math">$x = 4$</span>, basta operarmos o número dual</p>


<pre class='hljl'>
<span class='hljl-n'>x</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-ni'>4</span><span class='hljl-p'>,</span><span class='hljl-ni'>1</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nf'>println</span><span class='hljl-p'>(</span><span class='hljl-s'>&quot;x^3 = &quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>x</span><span class='hljl-oB'>^</span><span class='hljl-ni'>3</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nf'>println</span><span class='hljl-p'>(</span><span class='hljl-s'>&quot;O valor da derivada é &quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-oB'>^</span><span class='hljl-ni'>3</span><span class='hljl-p'>)</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nf'>print</span><span class='hljl-p'>(</span><span class='hljl-s'>&quot;De forma analitica: (x^3)&#39; = 3x^2, para x = 4 ⟹ 3*(4)^2 = 48&quot;</span><span class='hljl-p'>)</span>
</pre>


<pre class="output">
x^3 &#61; 64.0 &#43; 48.0ϵ
O valor da derivada é 48.0
De forma analitica: &#40;x^3&#41;&#39; &#61; 3x^2, para x &#61; 4 ⟹ 3*&#40;4&#41;^2 &#61; 48
</pre>


<p>Ensinamos ao computador como operar com as operações básica e com as funções <code>cos, sin, log</code> nos duais, o que acontece se tentarmos agora derivar uma expressão mais complicada? Sem ensinar nada sobre regra da cadeia ao nosso sistema de números duais?</p>
<p class="math">\[
g(x) = (\cos(x)+\sin(x^2)) \cdot \log(\sin(3x))
\]</p>
<p>Resolvendo analiticamente, temos como derivada:</p>
<p class="math">\[
g'(x) = \left(-\sin \left(x\right)+\cos \left(x^2\right)\cdot \:2x\right)\log \left(\sin \left(3x\right)\right)+3\cot \left(3x\right)\left(\cos \left(x\right)+\sin \left(x^2\right)\right)
\]</p>
<p>Vamos olhar para o valor da derivada em <span class="math">$x = \frac{\pi}{4}$</span></p>


<pre class='hljl'>
<span class='hljl-n'>x</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-n'>π</span><span class='hljl-oB'>/</span><span class='hljl-ni'>4</span><span class='hljl-p'>,</span><span class='hljl-ni'>1</span><span class='hljl-p'>)</span><span class='hljl-t'>

</span><span class='hljl-nf'>g</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-oB'>::</span><span class='hljl-n'>D</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>(</span><span class='hljl-nf'>cos</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>+</span><span class='hljl-t'> </span><span class='hljl-nf'>sin</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-oB'>^</span><span class='hljl-ni'>2</span><span class='hljl-p'>))</span><span class='hljl-oB'>*</span><span class='hljl-nf'>log</span><span class='hljl-p'>(</span><span class='hljl-nf'>sin</span><span class='hljl-p'>(</span><span class='hljl-ni'>3</span><span class='hljl-oB'>*</span><span class='hljl-n'>x</span><span class='hljl-p'>))</span><span class='hljl-t'>

</span><span class='hljl-nf'>∂g</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>(</span><span class='hljl-oB'>-</span><span class='hljl-nf'>sin</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-p'>)</span><span class='hljl-oB'>+</span><span class='hljl-nf'>cos</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-oB'>^</span><span class='hljl-ni'>2</span><span class='hljl-p'>)</span><span class='hljl-oB'>*</span><span class='hljl-ni'>2</span><span class='hljl-oB'>*</span><span class='hljl-n'>x</span><span class='hljl-p'>)</span><span class='hljl-oB'>*</span><span class='hljl-nf'>log</span><span class='hljl-p'>(</span><span class='hljl-nf'>sin</span><span class='hljl-p'>(</span><span class='hljl-ni'>3</span><span class='hljl-oB'>*</span><span class='hljl-n'>x</span><span class='hljl-p'>))</span><span class='hljl-oB'>+</span><span class='hljl-t'> </span><span class='hljl-ni'>3</span><span class='hljl-oB'>*</span><span class='hljl-nf'>cot</span><span class='hljl-p'>(</span><span class='hljl-ni'>3</span><span class='hljl-oB'>*</span><span class='hljl-n'>x</span><span class='hljl-p'>)</span><span class='hljl-oB'>*</span><span class='hljl-p'>(</span><span class='hljl-nf'>cos</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-p'>)</span><span class='hljl-oB'>+</span><span class='hljl-nf'>sin</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-oB'>^</span><span class='hljl-ni'>2</span><span class='hljl-p'>))</span><span class='hljl-t'> </span><span class='hljl-cs'>## Derivada analitíca</span><span class='hljl-t'>

</span><span class='hljl-nf'>println</span><span class='hljl-p'>(</span><span class='hljl-s'>&quot;O valor da derivada analitíca é: &quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-nf'>g</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-p'>)</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nf'>print</span><span class='hljl-p'>(</span><span class='hljl-s'>&quot;O valor da derivada utilizando números duais é: &quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-nf'>∂g</span><span class='hljl-p'>(</span><span class='hljl-n'>π</span><span class='hljl-oB'>/</span><span class='hljl-ni'>4</span><span class='hljl-p'>))</span>
</pre>


<pre class="output">
O valor da derivada analitíca é: -4.055728878490174
O valor da derivada utilizando números duais é: -4.055728878490173
</pre>


<h4>Números Duais e derivadas de ordem superior</h4>
<p>Derivadas de funções <span class="math">$f: \mathbb{R}^n \to \mathbb{R}$</span> também podem ser calculadas utilizando os números duais. Vamos tomar como exemplo a função <span class="math">$f: \underset{(x,y)}{\mathbb{R}^2} \underset{\mapsto}{\to} \underset{x^2sin(y)}{\mathbb{R}}$</span> Analiticamente, o gradiente de <span class="math">$f$</span> fica</p>
<p class="math">\[
\begin{align*}
\nabla f &= \left(\frac{\partial f}{\partial x},\frac{\partial f}{\partial y}\right)\\
&= \left(2x sin(y), x^2cos(y)\right)
\end{align*}
\]</p>
<p>Podemos calcular a derivada parcial de <span class="math">$f$</span> em relação a <span class="math">$x$</span> tomando um <span class="math">$y$</span> fixo e calculando a derivada de <span class="math">$f$</span> em <span class="math">$x$</span> da maneira usual isso nos dá uma ideia de como utilizar a álgebra dos Números Duais para calcular as derivadas parciais. Para isso basta usarmos como número Dual apenas a variável de interesse na chamada da função, por exemplo, dada a função <span class="math">$f$</span>, calculamos suas derivadas parciais com</p>


<pre class='hljl'>
<span class='hljl-nf'>f</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-p'>,</span><span class='hljl-n'>y</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>x</span><span class='hljl-oB'>^</span><span class='hljl-ni'>2</span><span class='hljl-oB'>*</span><span class='hljl-nf'>sin</span><span class='hljl-p'>(</span><span class='hljl-n'>y</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-n'>∂fDx</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>f</span><span class='hljl-p'>(</span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-ni'>2</span><span class='hljl-p'>,</span><span class='hljl-ni'>1</span><span class='hljl-p'>),</span><span class='hljl-t'> </span><span class='hljl-n'>π</span><span class='hljl-oB'>/</span><span class='hljl-ni'>3</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-cs'>## Derivada parcial de f_x utilizando Duais</span><span class='hljl-t'>
</span><span class='hljl-n'>∂fDy</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>f</span><span class='hljl-p'>(</span><span class='hljl-ni'>2</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-n'>π</span><span class='hljl-oB'>/</span><span class='hljl-ni'>3</span><span class='hljl-p'>,</span><span class='hljl-ni'>1</span><span class='hljl-p'>))</span><span class='hljl-t'> </span><span class='hljl-cs'>## Derivada parcial de f_y utilizando Duais</span><span class='hljl-t'>
</span><span class='hljl-nf'>println</span><span class='hljl-p'>(</span><span class='hljl-n'>∂fDx</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nf'>print</span><span class='hljl-p'>(</span><span class='hljl-n'>∂fDy</span><span class='hljl-p'>)</span>
</pre>


<pre class="output">
3.4641016151377544 &#43; 3.4641016151377544ϵ
3.4641016151377544 &#43; 2.0000000000000004ϵ
</pre>


<p>Podemos comparar os resultados com o resultado analitíco</p>


<pre class='hljl'>
<span class='hljl-nf'>∂f∂x</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-p'>,</span><span class='hljl-n'>y</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>2</span><span class='hljl-oB'>*</span><span class='hljl-n'>x</span><span class='hljl-oB'>*</span><span class='hljl-nf'>sin</span><span class='hljl-p'>(</span><span class='hljl-n'>y</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-cs'>## Derivada parcial de f_x analitica</span><span class='hljl-t'>
</span><span class='hljl-nf'>∂f∂y</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-p'>,</span><span class='hljl-n'>y</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>x</span><span class='hljl-oB'>^</span><span class='hljl-ni'>2</span><span class='hljl-oB'>*</span><span class='hljl-nf'>cos</span><span class='hljl-p'>(</span><span class='hljl-n'>y</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-cs'>## Derivada parcial de f_y analitica</span><span class='hljl-t'>

</span><span class='hljl-nf'>println</span><span class='hljl-p'>(</span><span class='hljl-s'>&quot;O vetor gradiente calculado de forma analítica é dado por: ( &quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-nf'>∂f∂x</span><span class='hljl-p'>(</span><span class='hljl-ni'>2</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>π</span><span class='hljl-oB'>/</span><span class='hljl-ni'>3</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-p'>,</span><span class='hljl-s'>&quot;,&quot;</span><span class='hljl-p'>,</span><span class='hljl-nf'>∂f∂y</span><span class='hljl-p'>(</span><span class='hljl-ni'>2</span><span class='hljl-p'>,</span><span class='hljl-n'>π</span><span class='hljl-oB'>/</span><span class='hljl-ni'>3</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;)&quot;</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nf'>println</span><span class='hljl-p'>(</span><span class='hljl-s'>&quot;O vetor gradiente calculado de por números duais é dado por: ( &quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>∂fDx</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;,&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>∂fDy</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;)&quot;</span><span class='hljl-p'>)</span>
</pre>


<pre class="output">
O vetor gradiente calculado de forma analítica é dado por: &#40; 3.464101615137
7544,2.0000000000000004&#41;
O vetor gradiente calculado de por números duais é dado por: &#40; 3.4641016151
377544,2.0000000000000004&#41;
</pre>


<p>O principio pode ser generalizado para calcular a matriz jacobiana de funções <span class="math">$\mathbb{R}^n \to \mathbb{R}^m$</span></p>


<pre class='hljl'>
<span class='hljl-nf'>h</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-p'>,</span><span class='hljl-n'>y</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>(</span><span class='hljl-nf'>sin</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-p'>)</span><span class='hljl-oB'>*</span><span class='hljl-n'>y</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>x</span><span class='hljl-oB'>*</span><span class='hljl-nf'>cos</span><span class='hljl-p'>(</span><span class='hljl-n'>y</span><span class='hljl-p'>))</span><span class='hljl-t'>
</span><span class='hljl-n'>A</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>[[</span><span class='hljl-nf'>h</span><span class='hljl-p'>(</span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-n'>π</span><span class='hljl-oB'>/</span><span class='hljl-ni'>2</span><span class='hljl-p'>,</span><span class='hljl-ni'>1</span><span class='hljl-p'>),</span><span class='hljl-t'> </span><span class='hljl-n'>π</span><span class='hljl-oB'>/</span><span class='hljl-ni'>4</span><span class='hljl-t'> </span><span class='hljl-p'>)[</span><span class='hljl-ni'>1</span><span class='hljl-p'>]</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-nf'>h</span><span class='hljl-p'>(</span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-n'>π</span><span class='hljl-oB'>/</span><span class='hljl-ni'>2</span><span class='hljl-p'>,</span><span class='hljl-ni'>1</span><span class='hljl-p'>),</span><span class='hljl-t'> </span><span class='hljl-n'>π</span><span class='hljl-oB'>/</span><span class='hljl-ni'>4</span><span class='hljl-t'> </span><span class='hljl-p'>)[</span><span class='hljl-ni'>2</span><span class='hljl-p'>]</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-p'>],[</span><span class='hljl-nf'>h</span><span class='hljl-p'>(</span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-n'>π</span><span class='hljl-oB'>/</span><span class='hljl-ni'>2</span><span class='hljl-p'>,</span><span class='hljl-ni'>1</span><span class='hljl-p'>),</span><span class='hljl-t'> </span><span class='hljl-n'>π</span><span class='hljl-oB'>/</span><span class='hljl-ni'>4</span><span class='hljl-t'> </span><span class='hljl-p'>)[</span><span class='hljl-ni'>1</span><span class='hljl-p'>]</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-nf'>h</span><span class='hljl-p'>(</span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-n'>π</span><span class='hljl-oB'>/</span><span class='hljl-ni'>2</span><span class='hljl-p'>,</span><span class='hljl-ni'>1</span><span class='hljl-p'>),</span><span class='hljl-t'> </span><span class='hljl-n'>π</span><span class='hljl-oB'>/</span><span class='hljl-ni'>4</span><span class='hljl-t'> </span><span class='hljl-p'>)[</span><span class='hljl-ni'>2</span><span class='hljl-p'>]</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-p'>]]</span><span class='hljl-t'>
</span><span class='hljl-nf'>show</span><span class='hljl-p'>(</span><span class='hljl-n'>stdout</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-s'>&quot;text/plain&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>A</span><span class='hljl-p'>)</span>
</pre>


<pre class="output">
2-element Array&#123;Array&#123;Float64,1&#125;,1&#125;:
 &#91;4.8091767343044744e-17, 0.7071067811865476&#93;
 &#91;4.8091767343044744e-17, 0.7071067811865476&#93;
</pre>


<h2>Diferenciação Automática &#40;Automatic Differentiation&#41;</h2>
<p>Podemos dividir os metódos de calcular computacionalmente derivadas em 4 categorias &#40;Baydin et al. &#40;2018&#41;&#41;</p>
<ol>
<li><p>Encontrar a fórmula analiticamente e executar o cálculo com o computador;</p>
</li>
<li><p>Derivação númerica atráves de diferenças finitas;</p>
</li>
<li><p>Diferenciação Simbólica, atráves de um <code>SAS</code> &#40;Symbolic Algebra System&#41;</p>
</li>
<li><p>Diferenciação Automática</p>
</li>
</ol>
<p>É importante notar que as <code>4</code> categorias estão bem divididas entre si, neste sentido, a Diferenciação Automática NÃO é uma derivação númerica, e também não é uma derivação simbólica, alguns autores trazem um conceito de ser um meio termo entre os dois metódos.</p>
<p>Enquanto a Diferenciação Númerica nos dá o valor númerico da derivada da função em um ponto, ela é um metódo aproximado do cálculo dessas derivadas, baseado na definição assíntotica de derivada.</p>
<p>A Diferenciação Simbólica não introduz erros de truncamento e não é uma aproximação, em um sentido de produzir um valor exato para a derivada, mas traz consigo problemas de que os cálculos e expressões a serem computadas envolvidas no processo crescem exponencialmente, e podem ficar bem complicadas até para uma função aparentemente simples.</p>
<p>No meio temos a Diferenciação Automática, que entrega um valor númerico da derivada no ponto mas não é uma aproximação, é um valor exato. O fato de termos um valor exato da derivada vem da expansão em série de Taylor vista na seção anterior, todos os termos de derivadas de ordem maior que <code>2</code> são cancelados pois estão sendo multiplicados por <code>ϵ² &#61; 0</code></p>
<p>A Diferenciação Automática possui dois metódos principais para o cálculo das derivadas, cada um com suas vantagens e particularidades</p>
<h5>Preparativos</h5>
<p>Para os próximos exemplos vamos tomar a seguinte função <span class="math">$h: \mathbb{R}^3 \to \mathbb{R}$</span>, avaliada no ponto <span class="math">$\theta = (-1, π/4, 2π)$</span></p>
<p class="math">\[
\begin{align*}
h(x,y,z) &= (x+y)\sin(yz)\\
\frac{\partial h}{\partial x} &= \sin(yz)\\
\frac{\partial h}{\partial y} &= \sin(yz) + z(x+y)\cos(yz)\\
\frac{\partial h}{\partial z} &= (x+y)y\cos(yz)\\
\end{align*}
\]</p>


<pre class='hljl'>
<span class='hljl-nf'>h</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-p'>,</span><span class='hljl-n'>y</span><span class='hljl-p'>,</span><span class='hljl-n'>z</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-oB'>+</span><span class='hljl-n'>y</span><span class='hljl-p'>)</span><span class='hljl-oB'>*</span><span class='hljl-nf'>sin</span><span class='hljl-p'>(</span><span class='hljl-n'>y</span><span class='hljl-oB'>*</span><span class='hljl-n'>z</span><span class='hljl-p'>)</span><span class='hljl-t'>

</span><span class='hljl-nf'>∂h∂x</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-p'>,</span><span class='hljl-n'>y</span><span class='hljl-p'>,</span><span class='hljl-n'>z</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>sin</span><span class='hljl-p'>(</span><span class='hljl-n'>y</span><span class='hljl-oB'>*</span><span class='hljl-n'>z</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nf'>∂h∂y</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-p'>,</span><span class='hljl-n'>y</span><span class='hljl-p'>,</span><span class='hljl-n'>z</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>sin</span><span class='hljl-p'>(</span><span class='hljl-n'>y</span><span class='hljl-oB'>*</span><span class='hljl-n'>z</span><span class='hljl-p'>)</span><span class='hljl-oB'>+</span><span class='hljl-n'>z</span><span class='hljl-oB'>*</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-oB'>+</span><span class='hljl-n'>y</span><span class='hljl-p'>)</span><span class='hljl-oB'>*</span><span class='hljl-nf'>cos</span><span class='hljl-p'>(</span><span class='hljl-n'>y</span><span class='hljl-oB'>*</span><span class='hljl-n'>z</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nf'>∂h∂z</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-p'>,</span><span class='hljl-n'>y</span><span class='hljl-p'>,</span><span class='hljl-n'>z</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-oB'>+</span><span class='hljl-n'>y</span><span class='hljl-p'>)</span><span class='hljl-oB'>*</span><span class='hljl-n'>y</span><span class='hljl-oB'>*</span><span class='hljl-nf'>cos</span><span class='hljl-p'>(</span><span class='hljl-n'>y</span><span class='hljl-oB'>*</span><span class='hljl-n'>z</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-n'>θ</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-p'>[</span><span class='hljl-oB'>-</span><span class='hljl-ni'>1</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>π</span><span class='hljl-oB'>/</span><span class='hljl-ni'>4</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>2</span><span class='hljl-oB'>*</span><span class='hljl-n'>π</span><span class='hljl-p'>]</span>
</pre>


<pre class="output">
3-element Array&#123;Float64,1&#125;:
 -1.0
  0.7853981633974483
  6.283185307179586
</pre>


<p>Notação: Quando utilizo subscrito <span class="math">$\epsilon$</span> em um número dual, quer dizer que estou tomando apenas a parte dual, que acompanha o <span class="math">$\epsilon$</span>, por exemplo: <span class="math">$(2+\epsilon)^2 = 2+4\epsilon$</span>, mas <span class="math">$(2+\epsilon)^2_\epsilon = 4$</span></p>
<h4>Forward AD</h4>
<p>Vamos visualizar a função como um grafo computacional, onde o cálculo dos valores da função são divididos em cada etapa <img src="diagrama1.png" alt="Grafo computacional para h&#40;x&#41; &#61; w" /> Agora podemos pensar em como calcular <span class="math">$\frac{\partial h}{\partial y}$</span>, dado que <span class="math">$h(θ) = w$</span></p>
<p class="math">\[
\begin{align*}
w &= tu\\
&= (x+y)\sin(v)\\
&= (x+y)\sin(yz)\\ \\
w_y &= (t(y)u(y))'\\
&= t'(y)u(y) + t(y)u'(y)\\
&= h(x, y+\epsilon, z)_\epsilon
\end{align*}
\]</p>
<p>Então usar o metódo <code>Forward AD</code> nada mais é do que avaliar a função no ponto com Números Duais, mas vamos implementar o procedimento de grafo computacional acima para calcular a derivada no ponto <span class="math">$\theta$</span>, e também por números Duais</p>


<pre class='hljl'>
<span class='hljl-k'>function</span><span class='hljl-t'> </span><span class='hljl-nf'>ForwardAD</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-p'>,</span><span class='hljl-n'>y</span><span class='hljl-p'>,</span><span class='hljl-n'>z</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>em</span><span class='hljl-oB'>=</span><span class='hljl-sc'>&#39;x&#39;</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-cs'>## Traço</span><span class='hljl-t'>
    </span><span class='hljl-n'>t</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>x</span><span class='hljl-oB'>+</span><span class='hljl-n'>y</span><span class='hljl-t'>
    </span><span class='hljl-n'>v</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>y</span><span class='hljl-oB'>*</span><span class='hljl-n'>z</span><span class='hljl-t'>
    </span><span class='hljl-n'>u</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>sin</span><span class='hljl-p'>(</span><span class='hljl-n'>v</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>w</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>t</span><span class='hljl-oB'>*</span><span class='hljl-n'>u</span><span class='hljl-t'>

    </span><span class='hljl-cs'>## Tangentes</span><span class='hljl-t'>
    </span><span class='hljl-k'>if</span><span class='hljl-t'> </span><span class='hljl-n'>em</span><span class='hljl-t'> </span><span class='hljl-oB'>==</span><span class='hljl-t'> </span><span class='hljl-sc'>&#39;x&#39;</span><span class='hljl-t'>
        </span><span class='hljl-n'>t̄</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-t'>
        </span><span class='hljl-n'>v̄</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>0</span><span class='hljl-t'>
        </span><span class='hljl-n'>ū</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>0</span><span class='hljl-t'>
        </span><span class='hljl-n'>w̄</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>t̄</span><span class='hljl-oB'>*</span><span class='hljl-n'>u</span><span class='hljl-t'>
    </span><span class='hljl-k'>elseif</span><span class='hljl-t'> </span><span class='hljl-n'>em</span><span class='hljl-t'> </span><span class='hljl-oB'>==</span><span class='hljl-t'> </span><span class='hljl-sc'>&#39;y&#39;</span><span class='hljl-t'>
        </span><span class='hljl-n'>t̄</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-t'>
        </span><span class='hljl-n'>v̄</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>z</span><span class='hljl-t'>
        </span><span class='hljl-n'>ū</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>cos</span><span class='hljl-p'>(</span><span class='hljl-n'>v</span><span class='hljl-p'>)</span><span class='hljl-oB'>*</span><span class='hljl-n'>v̄</span><span class='hljl-t'>
        </span><span class='hljl-n'>w̄</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>u</span><span class='hljl-t'> </span><span class='hljl-oB'>+</span><span class='hljl-t'> </span><span class='hljl-n'>ū</span><span class='hljl-oB'>*</span><span class='hljl-n'>t</span><span class='hljl-t'>
    </span><span class='hljl-k'>else</span><span class='hljl-t'>
        </span><span class='hljl-n'>t̄</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>0</span><span class='hljl-t'>
        </span><span class='hljl-n'>v̄</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>y</span><span class='hljl-t'>
        </span><span class='hljl-n'>ū</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>cos</span><span class='hljl-p'>(</span><span class='hljl-n'>v</span><span class='hljl-p'>)</span><span class='hljl-oB'>*</span><span class='hljl-n'>v̄</span><span class='hljl-t'>
        </span><span class='hljl-n'>w̄</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>ū</span><span class='hljl-oB'>*</span><span class='hljl-n'>t</span><span class='hljl-t'>
    </span><span class='hljl-k'>end</span><span class='hljl-t'>
</span><span class='hljl-k'>end</span>
</pre>


<pre class="output">
ForwardAD &#40;generic function with 2 methods&#41;
</pre>


<p>E podemos visualizar os resultados</p>


<pre class='hljl'>
<span class='hljl-nf'>println</span><span class='hljl-p'>(</span><span class='hljl-s'>&quot;Forward implementado manualmente: ∇h = (&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-nf'>ForwardAD</span><span class='hljl-p'>(</span><span class='hljl-n'>θ</span><span class='hljl-oB'>...</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>&#39;x&#39;</span><span class='hljl-p'>),</span><span class='hljl-s'>&quot;,&quot;</span><span class='hljl-p'>,</span><span class='hljl-nf'>ForwardAD</span><span class='hljl-p'>(</span><span class='hljl-n'>θ</span><span class='hljl-oB'>...</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>&#39;y&#39;</span><span class='hljl-p'>),</span><span class='hljl-s'>&quot;,&quot;</span><span class='hljl-p'>,</span><span class='hljl-nf'>ForwardAD</span><span class='hljl-p'>(</span><span class='hljl-n'>θ</span><span class='hljl-oB'>...</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-sc'>&#39;z&#39;</span><span class='hljl-p'>),</span><span class='hljl-s'>&quot;)&quot;</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nf'>println</span><span class='hljl-p'>(</span><span class='hljl-s'>&quot;Forward implementado com Duais: ∇h = (&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-nf'>h</span><span class='hljl-p'>(</span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-oB'>-</span><span class='hljl-ni'>1</span><span class='hljl-p'>,</span><span class='hljl-ni'>1</span><span class='hljl-p'>),</span><span class='hljl-t'> </span><span class='hljl-n'>π</span><span class='hljl-oB'>/</span><span class='hljl-ni'>4</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-ni'>2</span><span class='hljl-oB'>*</span><span class='hljl-n'>π</span><span class='hljl-p'>)</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-p'>,</span><span class='hljl-s'>&quot;,&quot;</span><span class='hljl-p'>,</span><span class='hljl-nf'>h</span><span class='hljl-p'>(</span><span class='hljl-oB'>-</span><span class='hljl-ni'>1</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-n'>π</span><span class='hljl-oB'>/</span><span class='hljl-ni'>4</span><span class='hljl-p'>,</span><span class='hljl-ni'>1</span><span class='hljl-p'>),</span><span class='hljl-t'> </span><span class='hljl-ni'>2</span><span class='hljl-oB'>*</span><span class='hljl-n'>π</span><span class='hljl-p'>)</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-p'>,</span><span class='hljl-s'>&quot;,&quot;</span><span class='hljl-p'>,</span><span class='hljl-nf'>h</span><span class='hljl-p'>(</span><span class='hljl-oB'>-</span><span class='hljl-ni'>1</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-n'>π</span><span class='hljl-oB'>/</span><span class='hljl-ni'>4</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-ni'>2</span><span class='hljl-oB'>*</span><span class='hljl-n'>π</span><span class='hljl-p'>,</span><span class='hljl-ni'>1</span><span class='hljl-p'>))</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-p'>,</span><span class='hljl-s'>&quot;)&quot;</span><span class='hljl-p'>)</span><span class='hljl-t'>
</span><span class='hljl-nf'>println</span><span class='hljl-p'>(</span><span class='hljl-s'>&quot;Gradiente calculado analiticamente: ∇h = (&quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-nf'>∂h∂x</span><span class='hljl-p'>(</span><span class='hljl-n'>θ</span><span class='hljl-oB'>...</span><span class='hljl-p'>),</span><span class='hljl-s'>&quot;,&quot;</span><span class='hljl-p'>,</span><span class='hljl-nf'>∂h∂y</span><span class='hljl-p'>(</span><span class='hljl-n'>θ</span><span class='hljl-oB'>...</span><span class='hljl-p'>),</span><span class='hljl-s'>&quot;,&quot;</span><span class='hljl-p'>,</span><span class='hljl-nf'>∂h∂z</span><span class='hljl-p'>(</span><span class='hljl-n'>θ</span><span class='hljl-oB'>...</span><span class='hljl-p'>),</span><span class='hljl-s'>&quot;)&quot;</span><span class='hljl-p'>)</span>
</pre>


<pre class="output">
Forward implementado manualmente: ∇h &#61; &#40;-0.9753679720836315,-1.272799766223
79,-0.03717897426751981&#41;
Forward implementado com Duais: ∇h &#61; &#40;-0.9753679720836315,-1.27279976622379
,-0.03717897426751981&#41;
Gradiente calculado analiticamente: ∇h &#61; &#40;-0.9753679720836315,-1.2727997662
2379,-0.03717897426751981&#41;
</pre>


<h4>Reverse AD</h4>
<p>Vamos agora olhar para o outro metódo de Diferenciação Automática, o metódo reverso, que nada mais é do que a aplicação da regra da cadeia multivariável.</p>
<h5>Regra da Cadeia multivariável</h5>
<p>Vamos olhar para o diagrama da regra da cadeia de uma função <span class="math">$z(x(s,t),y(s,t))$</span></p>
<p><img src="chainrule.png" alt="Árvore para a regra da cadeia" /></p>
<p>Para calcular as derivadas parciais de <span class="math">$z$</span> em relação a <span class="math">$s,t$</span>, podemos vir &quot;descendo&quot; a árvore multiplicando as derivadas que estão no mesmo caminho, se alguma variável alvo aparece em dois &quot;ramos&quot; diferentes da árvore, somamos os ramos ao final,  ficando então:</p>
<p class="math">\[
\begin{align*}
\frac{\partial z}{\partial s} &= \frac{\partial z}{\partial x}\frac{\partial x}{\partial s} + \frac{\partial z}{\partial y}\frac{\partial y}{\partial s}\\
\frac{\partial z}{\partial t} &= \frac{\partial z}{\partial x}\frac{\partial x}{\partial t} + \frac{\partial z}{\partial y}\frac{\partial y}{\partial t}
\end{align*}
\]</p>
<p>Se você entendeu o processo de cálculo das derivadas parciais de <span class="math">$z$</span> atráves desta árvore, você entendeu o modo reverso da Diferenciação Automática&#33;&#33;</p>
<h5>O procedimento para Reverse AD</h5>
<p>Há dois passos para o cálculo das derivadas pelo metódo reverso, o primeiro é chamado de <code>Forward Pass</code>, que é avaliar a função atráves do grafo computacional visto na seção sobre <code>Forward AD</code>, e com isso teremos as variáveis do traço da mesma maneira, mas ao invés de calcular as tangentes, que seriam as derivadas de cada variável do traço em relação às variáveis de entrada, calculamos agora o <code>adjunto</code>, que é a derivada da função em razão de variável do traço. Nesse sentido temos</p>
<table><tr><th>Traço</th><th>Adjunto</th></tr><tr><td><span class="math">$t = x+y$</span></td><td><span class="math">$\bar{w}=\frac{\partial w}{\partial w}=1$</span></td></tr><tr><td><span class="math">$v=yz$</span></td><td><span class="math">$\bar{u}=\frac{\partial w}{\partial u}\bar{w}$</span></td></tr><tr><td><span class="math">$u=sin(v)$</span></td><td><span class="math">$\bar{v}=\frac{\partial u}{\partial v}\bar{u}$</span></td></tr><tr><td><span class="math">$w = tu$</span></td><td><span class="math">$\bar{t} = \frac{\partial w}{\partial t}\bar{w}$</span></td></tr><tr><td></td><td><span class="math">$\bar{x} = \frac{\partial t}{\partial x}\bar{t} = \frac{\partial w}{\partial x}$</span></td></tr><tr><td></td><td><span class="math">$\bar{y} = \frac{\partial t}{\partial y}\bar{t}+\frac{\partial v}{\partial y}\bar{v} = \frac{\partial w}{\partial y}$</span></td></tr><tr><td></td><td><span class="math">$\bar{z} = \frac{\partial v}{\partial z}\bar{v} = \frac{\partial w}{\partial z}$</span></td></tr></table>
<p>Perceba que as variáveis adjuntas nos dão um sistema a ser resolvido&#33; Podemos então montar a seguinte matriz</p>
<p class="math">\[
A = \left[\begin{array}{ccccccc} 1 & 0 & 0 & 0 & 0 & 0 & 0 \\ -\frac{\partial w}{\partial u} & 1 & 0 & 0 & 0 & 0 & 0 \\ 0 & -\frac{\partial u}{\partial v} & 1 & 0 & 0 & 0 & 0 \\ -\frac{\partial w}{\partial t} & 0 & 0 & 1 & 0 & 0 & 0 \\ 0 & 0 & 0 & -\frac{\partial t}{\partial x} & 1 & 0 & 0 \\ 0 & 0 & -\frac{\partial v}{\partial y} & -\frac{\partial t}{\partial y} & 0 & 1 & 0 \\ 0 & 0 & -\frac{\partial v}{\partial z} & 0 & 0 & 0 & 1 \end{array}\right], X = \left[\begin{array}{c} \bar{w} \\ \bar{u} \\ \bar{v} \\ \bar{t} \\ \bar{x} \\ \bar{y} \\ \bar{z} \end{array}\right]
\]</p>
<p>Perceba que este sistema nos dá</p>
<p class="math">\[
AX = \left[\begin{array}{ccccccc} 1&0&0&0&0&0&0 \end{array}\right]^t
\]</p>
<p>Como a matriz é triangular, é bem fácil resolvermos e as últimas componentes do vetor <span class="math">$X$</span> serão o vetor gradiente que estamos em busca. Basta então calcular as derivadas intermediárias, podem ser calculadas a mão, ou utilizando números duais, vamos escrever a função que faz o <code>Reverse AD</code> para calcular <span class="math">$\nabla h(x,y,z)$</span></p>


<pre class='hljl'>
<span class='hljl-k'>using</span><span class='hljl-t'> </span><span class='hljl-n'>LinearAlgebra</span><span class='hljl-t'>
</span><span class='hljl-k'>function</span><span class='hljl-t'> </span><span class='hljl-nf'>ReverseAD</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-p'>,</span><span class='hljl-n'>y</span><span class='hljl-p'>,</span><span class='hljl-n'>z</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-cs'>## Traço</span><span class='hljl-t'>
    </span><span class='hljl-n'>tx</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-n'>x</span><span class='hljl-p'>,</span><span class='hljl-ni'>1</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>+</span><span class='hljl-t'> </span><span class='hljl-n'>y</span><span class='hljl-t'>
    </span><span class='hljl-n'>ty</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>x</span><span class='hljl-t'> </span><span class='hljl-oB'>+</span><span class='hljl-t'> </span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-n'>y</span><span class='hljl-p'>,</span><span class='hljl-ni'>1</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>vy</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-n'>y</span><span class='hljl-p'>,</span><span class='hljl-ni'>1</span><span class='hljl-p'>)</span><span class='hljl-oB'>*</span><span class='hljl-n'>z</span><span class='hljl-t'>
    </span><span class='hljl-n'>vz</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>y</span><span class='hljl-oB'>*</span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-n'>z</span><span class='hljl-p'>,</span><span class='hljl-ni'>1</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>u</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>sin</span><span class='hljl-p'>(</span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-n'>vy</span><span class='hljl-oB'>.</span><span class='hljl-n'>v</span><span class='hljl-p'>,</span><span class='hljl-ni'>1</span><span class='hljl-p'>))</span><span class='hljl-t'>
    </span><span class='hljl-n'>wu</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>tx</span><span class='hljl-oB'>.</span><span class='hljl-n'>v</span><span class='hljl-oB'>*</span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-n'>u</span><span class='hljl-oB'>.</span><span class='hljl-n'>v</span><span class='hljl-p'>,</span><span class='hljl-ni'>1</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>wt</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>D</span><span class='hljl-p'>(</span><span class='hljl-n'>tx</span><span class='hljl-oB'>.</span><span class='hljl-n'>v</span><span class='hljl-p'>,</span><span class='hljl-ni'>1</span><span class='hljl-p'>)</span><span class='hljl-oB'>*</span><span class='hljl-n'>u</span><span class='hljl-oB'>.</span><span class='hljl-n'>v</span><span class='hljl-t'>

    </span><span class='hljl-n'>∂w∂u</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>wu</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-t'>
    </span><span class='hljl-n'>∂u∂v</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>u</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-t'>
    </span><span class='hljl-n'>∂w∂t</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>wt</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-t'>
    </span><span class='hljl-n'>∂t∂x</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>tx</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-t'>
    </span><span class='hljl-n'>∂t∂y</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>ty</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-t'>
    </span><span class='hljl-n'>∂v∂y</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>vy</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-t'>
    </span><span class='hljl-n'>∂v∂z</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>vz</span><span class='hljl-oB'>.</span><span class='hljl-n'>ϵ</span><span class='hljl-t'>

    </span><span class='hljl-n'>A</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>zeros</span><span class='hljl-p'>(</span><span class='hljl-ni'>7</span><span class='hljl-p'>,</span><span class='hljl-ni'>7</span><span class='hljl-p'>)</span><span class='hljl-t'> </span><span class='hljl-oB'>+</span><span class='hljl-t'> </span><span class='hljl-n'>I</span><span class='hljl-t'>
    </span><span class='hljl-n'>A</span><span class='hljl-p'>[</span><span class='hljl-ni'>2</span><span class='hljl-p'>,</span><span class='hljl-ni'>1</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-oB'>-</span><span class='hljl-n'>∂w∂u</span><span class='hljl-t'>
    </span><span class='hljl-n'>A</span><span class='hljl-p'>[</span><span class='hljl-ni'>3</span><span class='hljl-p'>,</span><span class='hljl-ni'>2</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-oB'>-</span><span class='hljl-n'>∂u∂v</span><span class='hljl-t'>
    </span><span class='hljl-n'>A</span><span class='hljl-p'>[</span><span class='hljl-ni'>4</span><span class='hljl-p'>,</span><span class='hljl-ni'>1</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-oB'>-</span><span class='hljl-n'>∂w∂t</span><span class='hljl-t'>
    </span><span class='hljl-n'>A</span><span class='hljl-p'>[</span><span class='hljl-ni'>5</span><span class='hljl-p'>,</span><span class='hljl-ni'>4</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-oB'>-</span><span class='hljl-n'>∂t∂x</span><span class='hljl-t'>
    </span><span class='hljl-n'>A</span><span class='hljl-p'>[</span><span class='hljl-ni'>6</span><span class='hljl-p'>,</span><span class='hljl-ni'>3</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-oB'>-</span><span class='hljl-n'>∂v∂y</span><span class='hljl-t'>
    </span><span class='hljl-n'>A</span><span class='hljl-p'>[</span><span class='hljl-ni'>6</span><span class='hljl-p'>,</span><span class='hljl-ni'>4</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-oB'>-</span><span class='hljl-n'>∂t∂y</span><span class='hljl-t'>
    </span><span class='hljl-n'>A</span><span class='hljl-p'>[</span><span class='hljl-ni'>7</span><span class='hljl-p'>,</span><span class='hljl-ni'>3</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-oB'>-</span><span class='hljl-n'>∂v∂z</span><span class='hljl-t'>
    </span><span class='hljl-n'>b</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-nf'>zeros</span><span class='hljl-p'>(</span><span class='hljl-ni'>7</span><span class='hljl-p'>)</span><span class='hljl-t'>
    </span><span class='hljl-n'>b</span><span class='hljl-p'>[</span><span class='hljl-ni'>1</span><span class='hljl-p'>]</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-ni'>1</span><span class='hljl-t'>
    </span><span class='hljl-n'>X</span><span class='hljl-t'> </span><span class='hljl-oB'>=</span><span class='hljl-t'> </span><span class='hljl-n'>A</span><span class='hljl-oB'>\</span><span class='hljl-n'>b</span><span class='hljl-t'>
    </span><span class='hljl-k'>return</span><span class='hljl-t'> </span><span class='hljl-n'>X</span><span class='hljl-p'>[</span><span class='hljl-k'>end</span><span class='hljl-oB'>-</span><span class='hljl-ni'>2</span><span class='hljl-oB'>:</span><span class='hljl-k'>end</span><span class='hljl-p'>]</span><span class='hljl-t'>
</span><span class='hljl-k'>end</span>
</pre>


<pre class="output">
ReverseAD &#40;generic function with 1 method&#41;
</pre>


<p>Calculando em <span class="math">$\theta$</span></p>


<pre class='hljl'>
<span class='hljl-nf'>println</span><span class='hljl-p'>(</span><span class='hljl-s'>&quot;∇h(θ) = &quot;</span><span class='hljl-p'>,</span><span class='hljl-t'> </span><span class='hljl-nf'>ReverseAD</span><span class='hljl-p'>(</span><span class='hljl-n'>θ</span><span class='hljl-oB'>...</span><span class='hljl-p'>))</span>
</pre>


<pre class="output">
∇h&#40;θ&#41; &#61; &#91;-0.9753679720836315, -1.27279976622379, -0.03717897426751981&#93;
</pre>


<p>Há outras maneiras de implementar o <code>Reverse AD</code>, está é uma das mais fáceis, e apresentado em <a href="#footnote-Austin" class="footnote">[Austin]</a>. Note que implementar o metódo reverso para um caso geral é muito mais complicado do que o metódo direto. Todos estes metódos estão implementados no <code>Julia</code> atráves das mais diversas bibliotecas: <code>ForwardDiff.jl, ReverseDiff.jl, DualNumbers.jl</code> e também nas biblitecas de Redes Neurais e Otimização da sua linguagem favorita.</p>
<h5>Custo computacional</h5>
<p>Vamos pensar na matriz Jacobiana de uma função <span class="math">$f: \mathbb{R}^n \to \mathbb{R}^m$</span></p>
<p class="math">\[
J_f = \begin{bmatrix}
\frac{\partial f_1}{\partial x_1} & \dots & \frac{\partial f_1}{\partial x_n}\\
\vdots & \ddots & \vdots \\
\frac{\partial f_m}{\partial x_1} & \dots & \frac{\partial f_m}{\partial x_n}\\
\end{bmatrix}
\]</p>
<p>Efetuar um &quot;passo&quot; do <code>Forward AD</code> em uma variável <span class="math">$x_k$</span> irá nos retornar</p>
<p class="math">\[
f(x_1, \dots, x_k + \epsilon, \dots, x_n) = (f_1, \dots, f_m) + \left(\frac{\partial f_1}{\partial x_k}, \dots, \frac{\partial f_m}{\partial x_k}\right)\epsilon
\]</p>
<p>Onde a parte associada ao número Dual é justamente uma coluna da matriz jacobiana, então para calcular toda a matriz seria preciso repetir a operação <span class="math">$n$</span> vezes. Seja <span class="math">$ops(f)$</span> o custo computacional/de operações para o cálculo de <span class="math">$f$</span>, e <span class="math">$c > 0$</span>, temos que o custo do metódo <code>Forward AD</code> é <span class="math">$n\cdot c \cdot ops(f)$</span> &#40;<a href="#footnote-Baydin" class="footnote">[Baydin]</a>&#41;. Isso nos dá uma ideia de que o metódo pode ser bom para funções <span class="math">$\mathbb{R}^n \to \mathbb{R}^m$</span> com <span class="math">$n \ll m$</span></p>
<p>No metódo <code>Reverse AD</code> quando calculamos um passo estamos calculando a derivada de uma função em relação à todas as variáveis de uma vez, nesse sentido:</p>
<p class="math">\[
\begin{align*}
f(x_1, \dots, x_n) &= (f_1, \dots, f_m)\\
&\text{Cada passo do Reverse AD irá calcular}\\
\nabla f_k &=  \left(\frac{\partial f_k}{\partial x_1}, \dots, \frac{\partial f_k}{\partial x_n}\right)
\end{align*}
\]</p>
<p>Então calculamos uma linha inteira da matriz Jacobiana, nesse sentido temos que o custo do metódo <code>reverseAD</code> é <span class="math">$m\cdot c \cdot ops(f)$</span> &#40;<a href="#footnote-Baydin" class="footnote">[Baydin]</a>&#41;. Isso nos dá uma ideia de que o metódo pode ser bom para funções <span class="math">$\mathbb{R}^n \to \mathbb{R}^m$</span> com <span class="math">$m \ll n$</span></p>
<p>Em particular, estamos interessados no modo reverso para funções de erro que são do tipo <span class="math">$\mathbb{R} \to \mathbb{R}^m$</span> que é utilizado em sua principal aplicação: Cálculo das derivadas para aprendizado com Gradiente Descendente</p>
<h4>Aplicações/Backpropagation</h4>
<p>O algoritmo de <code>Backpropagation</code> é um caso particular do modo de Diferenciação Automática Reverso quando aplicado a uma rede neural. No <code>Backpropagation</code> estamos interessados em calcular o gradiente de uma função <span class="math">$\mathbb{R}^n \to \mathbb{R}$</span> geralmente chamada de função perda, em razão dos parâmetros da rede neural &#40;pesos e vieses&#41;</p>
<h2>Referências</h2>
<ol>
<li><p><a href="https://page.mi.fu-berlin.de/rojas/neural/">Rojas, Raul &#40;1996&#41;. Neural Networks - A Systematic Introduction, Springer</a></p>
</li>
<li><p><a href="http://neuralnetworksanddeeplearning.com">Michael A. Nielsen &#40;2015&#41;, Neural Networks and Deep Learning, Determination Press</a></p>
</li>
<li><p><a href="http://www.ams.org/publicoutreach/feature-column/fc-2017-12">Austin, David &#40;2017&#41;. How to Differentiate with a Computer</a></p>
</li>
<li><p><a href="https://jmlr.org/papers/v18/17-468.html">Atilim Gunes Baydin et al. &#40;2018&#41;, Automatic Differentiation in Machine Learning: a Survey, JMLR</a></p>
</li>
<li><p><a href="https://mitmath.github.io/18337/lecture8/automatic_differentiation">Rackauckas, Chris &#40;2020&#41;. Forward-Mode Automatic Differentiation &#40;AD&#41; via High Dimensional Algebras</a></p>
</li>
</ol>


        <HR/>
        <div class="footer">
          <p>
            Published from <a href="automatic-differentiation.jmd">automatic-differentiation.jmd</a>
            using <a href="http://github.com/JunoLab/Weave.jl">Weave.jl</a> v0.10.6 on 2021-02-06.
          </p>
        </div>
      </div>
    </div>
  </div>
</BODY>

</HTML>
